## 1.2 å­˜å‚¨å™¨é‡‘å­—å¡”

é€Ÿåº¦ï¼š**CPUå†…éƒ¨**(*å¯„å­˜å™¨>L1>L2>L3*)>å†…å­˜>SSD>HDD

### å¯„å­˜å™¨
32ä½CPUä¸­å¯„å­˜å™¨å¯å­˜å‚¨**4**ä¸ªå­—èŠ‚  
64ä½CPUä¸­å¯„å­˜å™¨å¯å­˜å‚¨**8**ä¸ªå­—èŠ‚  

### CPU Cache
*Static Random-Access Memory*

#### *L1*  
2~4ä¸ªæ—¶é’Ÿå‘¨æœŸï¼ŒKBçº§
åˆ†ä¸ºæŒ‡ä»¤ç¼“å­˜å’Œæ•°æ®ç¼“å­˜

#### *L2*  
10~20ä¸ªæ—¶é’Ÿå‘¨æœŸï¼ŒKB~MB

#### *L3*
å¤šä¸ªCPUæ ¸å¿ƒå…±ç”¨ï¼ŒMBçº§  
20~60ä¸ªæ—¶é’Ÿå‘¨æœŸ

### å†…å­˜
*Dynamic Random Access Memory*  

**å­˜å‚¨å™¨åªå’Œç›¸é‚»ä¸€å±‚çš„å­˜å‚¨è®¾å¤‡æ‰“äº¤é“**  

**CPUæŸ¥è¯¢é¡ºåºï¼šå¯„å­˜å™¨->L1->L2->L3->å†…å­˜**  

---
## 1.3

Cache Line(ç¼“å­˜å—)ï¼šCPUä»å†…å­˜è¯»å–åˆ°cacheçš„æœ€å°å•ä½ã€‚

---
## 1.4 ç¼“å­˜ä¸€è‡´æ€§

* å†™ç›´è¾¾ (Write Through)
  >æ•°æ®åŒæ—¶å†™å…¥å†…å­˜å’ŒCacheä¸­
* å†™å› ï¼ˆWrite Backï¼‰
  >æ•°æ®å†™å…¥Cacheï¼ŒåŒæ—¶æ ‡è®°å…¶ä¸ºè„ï¼Œå³ä¸å†…å­˜æ•°æ®ä¸ä¸€è‡´ã€‚ä¸‹æ¬¡å†™å…¥å¦‚æœCacheä¸ºè„ï¼Œåˆ™å…ˆå†™å…¥å†…å­˜ï¼Œå†å†™å…¥Cacheã€‚å¦åˆ™æ ‡è®°ä¸ºå¹²å‡€ã€‚

* å†™ä¼ æ’­  
  >CPUæ ¸å¿ƒå†…çš„cacheæ›´æ–°æ—¶ï¼Œå¿…é¡»ä¼ æ’­åˆ°å…¶ä»–æ ¸å¿ƒçš„cache

* äº‹åŠ¡çš„ä¸²è¡ŒåŒ–  
  >CPUæ ¸å¿ƒå†…å¯¹æ•°æ®çš„æ“ä½œé¡ºåºï¼Œå¿…é¡»åœ¨å…¶ä»–æ ¸å¿ƒçœ‹èµ·æ¥é¡ºåºæ˜¯ä¸€æ ·çš„  
    * CPUæ ¸å¿ƒå¯¹cacheçš„æ“ä½œéœ€è¦åŒæ­¥ç»™å…¶ä»–CPUæ ¸å¿ƒï¼›
    * **é”ğŸ”’**ï¼šæ‹¿åˆ°äº†é”æ‰èƒ½è¿›è¡Œæ•°æ®æ›´æ–°ã€‚

### æ€»çº¿å—…æ¢ï¼ˆMESIåè®®ï¼‰

* Modifiedï¼Œå·²ä¿®æ”¹
  >è„æ ‡è®°
* Exclusiveï¼Œç‹¬å 
  > æ•°æ®åªå­˜å‚¨åœ¨ä¸€ä¸ªCPUæ ¸å¿ƒé‡Œï¼Œå¦‚æœ‰å…¶ä»–CPUä»å†…å­˜ä¸­è¯»è¿›äº†ç›¸åŒæ•°æ®ï¼Œåˆ™å˜ä¸ºå…±äº«
* Sharedï¼Œå…±äº«
  > 
* Invalidatedï¼Œå·²å¤±æ•ˆ

### æ€»ç»“

CPUè¯»å†™æ•°æ®éƒ½æ˜¯åœ¨è‡ªå·±çš„cacheä¸­è¿›è¡Œçš„

## 1.5 CPUæ˜¯å¦‚ä½•æ‰§è¡Œä»»åŠ¡çš„

### CPUå¦‚ä½•è¯»å†™æ•°æ®

**Cacheä¼ªå…±äº«**  
>å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä¸ªcache lineä¸­çš„ä¸åŒå˜é‡æ—¶ï¼Œè€Œå¯¼è‡´CPU cacheå¤±æ•ˆçš„ç°è±¡ã€‚

*ç»“æ„ä½“é‡Œçš„æˆå‘˜å˜é‡åœ¨ç‰©ç†å†…å­˜åœ°å€ä¸Šæ˜¯è¿ç»­çš„ï¼Œå› æ­¤å¯èƒ½**ä½äºåŒä¸€ä¸ªcache line***

```C++
struct test {
    int a;
    int b;
}
```
```C++
struct test {
    int a;
    int b __cacheline_aligned_in_smp;
}
```

*é¿å…ä¼ªå…±äº«*  
    1.ç©ºé—´æ¢æ—¶é—´   
    2.å­—èŠ‚å¡«å……(å‰ä¸ƒåä¸ƒ)+ç»§æ‰¿  

### CPUå¦‚ä½•é€‰æ‹©çº¿ç¨‹çš„  










